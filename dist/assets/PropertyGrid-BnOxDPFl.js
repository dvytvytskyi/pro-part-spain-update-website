import{a as z,u as R,j as e,H as _}from"./index-Bt-nM8nf.js";import{r as v,R as E}from"./mapbox-gl-BQyo5stt.js";import{C as w}from"./chevron-left-B8F2JZZz.js";import{C as y}from"./chevron-right-DqiLAAY1.js";import{b as A}from"./vendor-CWHnZUEh.js";function T({property:i}){const f=A(),{isFavorite:o,toggleFavorite:d}=z(),{t:m}=R(),h=o(i.id),[c,l]=v.useState({canScrollLeft:!1,canScrollRight:!0}),a=v.useRef(null),{title:x,location:N,price:u,size:t,type:C,currency:p}=v.useMemo(()=>{const s=(i.property_type||"").includes("New Building");let n=i.development_name||i.title||"Luxury Property";if(!s){const r=i.beds>0?`${i.beds} ${m("property.beds")} `:"",$=i.type||i.property_type||"Property",k=[i.town,i.province].filter(Boolean).join(", ");n=`${r}${$}${k?` ${m("common.in")} ${k}`:""}`}return{title:n,location:i.town||i.location||"Spain",price:i.price,size:i.built_area||i.total_area||i.size||"N/A",type:i.type||i.property_type||"Property",currency:i.currency||"€"}},[i,m]),j=v.useMemo(()=>{let s=[];return Array.isArray(i.images)&&i.images.length>0&&(s=i.images.map(n=>typeof n=="string"?n:n&&typeof n=="object"?n.image_url||n.url||n.path||Object.values(n).find(r=>typeof r=="string"&&r.startsWith("http")):null)),s.length===0&&i.image&&(s=[i.image]),s.filter(n=>n&&typeof n=="string"&&n.trim().startsWith("http"))},[i.images,i.image]),g=()=>{if(a.current){const{scrollLeft:s,scrollWidth:n,clientWidth:r}=a.current;l({canScrollLeft:s>0,canScrollRight:s<n-r-5})}};E.useEffect(()=>{if(g(),j.length<=1)return;const s=a.current;return s&&(s.addEventListener("scroll",g),window.addEventListener("resize",g)),()=>{s&&s.removeEventListener("scroll",g),window.removeEventListener("resize",g)}},[j]);const S=s=>s?typeof s=="number"?p+" "+s.toLocaleString():s:`${p}0`,b=s=>{if(a.current){const n=a.current,r=n.clientWidth;n.scrollBy({left:s==="left"?-r:r,behavior:"smooth"})}},L=()=>{const s=(i.property_type||"").toLowerCase();let n="new-building";s.includes("rent")?n="rent":s.includes("secondary")&&(n="secondary"),f(`/${n}/${i.id}`)};return e.jsxs("div",{className:"listing-card",onClick:L,style:{cursor:"pointer"},children:[e.jsxs("div",{className:"listing-image-wrapper",children:[e.jsx("div",{className:"card-image-carousel",ref:a,children:j.map((s,n)=>e.jsx("div",{className:"carousel-slide",children:e.jsx("img",{src:s,alt:`${x} - ${n+1}`,className:"listing-card-image",onError:r=>{r.target.onerror=null,r.target.style.display="none"}})},n))}),j.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`carousel-nav-btn prev ${c.canScrollLeft?"":"disabled"}`,onClick:s=>{s.stopPropagation(),c.canScrollLeft&&b("left")},disabled:!c.canScrollLeft,children:e.jsx(w,{size:20})}),e.jsx("button",{className:`carousel-nav-btn next ${c.canScrollRight?"":"disabled"}`,onClick:s=>{s.stopPropagation(),c.canScrollRight&&b("right")},disabled:!c.canScrollRight,children:e.jsx(y,{size:20})})]}),e.jsx("button",{className:`card-like-btn ${h?"liked":""}`,onClick:s=>{s.stopPropagation(),s.preventDefault(),d(i.id)},children:e.jsx(_,{size:20,fill:h?"currentColor":"none"})})]}),e.jsxs("div",{className:"listing-card-content",children:[e.jsxs("div",{className:"listing-card-row header-row",children:[e.jsx("h3",{className:"listing-card-title",children:x}),e.jsx("span",{className:"listing-card-price",children:S(u)})]}),e.jsx("div",{className:"listing-card-row sub-header-row",children:e.jsx("span",{className:"listing-card-location",children:N})}),e.jsx("div",{className:"listing-card-divider"}),e.jsxs("div",{className:"listing-card-row footer-row",children:[e.jsx("span",{className:"listing-card-type",children:C}),e.jsxs("span",{className:"listing-card-size",children:[m("property.size"),": ",t," m²"]})]})]})]})}function W(){return e.jsxs("div",{className:"listing-card skeleton-card",children:[e.jsx("div",{className:"listing-image-wrapper skeleton-pulse"}),e.jsxs("div",{className:"listing-card-content",children:[e.jsxs("div",{className:"listing-card-row header-row",children:[e.jsx("div",{className:"skeleton-line title-skeleton skeleton-pulse"}),e.jsx("div",{className:"skeleton-line price-skeleton skeleton-pulse"})]}),e.jsx("div",{className:"listing-card-row sub-header-row",children:e.jsx("div",{className:"skeleton-line location-skeleton skeleton-pulse"})}),e.jsx("div",{className:"listing-card-divider"}),e.jsxs("div",{className:"listing-card-row footer-row",children:[e.jsx("div",{className:"skeleton-line type-skeleton skeleton-pulse"}),e.jsx("div",{className:"skeleton-line size-skeleton skeleton-pulse"})]})]})]})}function D({properties:i=[],loading:f=!1,currentPage:o=1,totalPages:d=1,onPageChange:m}){Array.from({length:32}).map((l,a)=>({}));const h=i,c=l=>{l>=1&&l<=d&&m&&(m(l),window.scrollTo({top:0,behavior:"smooth"}))};return e.jsxs("div",{className:"listing-section",children:[e.jsx("div",{className:"listing-grid",children:f?Array.from({length:8}).map((l,a)=>e.jsx(W,{},a)):e.jsxs(e.Fragment,{children:[h.map(l=>e.jsx(T,{property:l},l.id)),h.length===0&&e.jsxs("div",{className:"no-results",style:{gridColumn:"1/-1",textAlign:"center",padding:"3rem"},children:[e.jsx("h3",{children:"No properties found"}),e.jsx("p",{style:{color:"#666"},children:"Try adjusting your search criteria"})]})]})}),!f&&d>1&&e.jsxs("div",{className:"pagination-container",children:[e.jsxs("button",{className:"pagination-btn pagination-nav-btn",onClick:()=>c(o-1),disabled:o===1,children:[e.jsx(w,{size:18,style:{marginRight:"4px"}})," Prev"]}),(()=>{const l=[],a=window.innerWidth<768?1:2,x=o-a,N=o+a+1;let u=0;for(let t=1;t<=d;t++)(t===1||t===d||t>=x&&t<N)&&(u!==0&&t!==u+1&&l.push(e.jsx("span",{className:"pagination-ellipsis",children:"..."},`dots-${t}`)),l.push(e.jsx("button",{className:`pagination-btn ${o===t?"active":""}`,onClick:()=>c(t),children:t},t)),u=t);return l})(),e.jsxs("button",{className:"pagination-btn pagination-nav-btn",onClick:()=>c(o+1),disabled:o===d,children:["Next ",e.jsx(y,{size:18,style:{marginLeft:"4px"}})]})]})]})}export{D as P};
