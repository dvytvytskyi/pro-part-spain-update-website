import{u as L,j as e}from"./index-D6DsswzB.js";import{r as a}from"./mapbox-gl-BQyo5stt.js";import{u as T,P as E}from"./PropertyFilters-DmDTvKks.js";import{P as M}from"./PropertyGrid-CGK7fZr7.js";import{g as C}from"./client-DjafAzYx.js";/* empty css                          */import{u as _}from"./vendor-CWHnZUEh.js";import"./staticLocations-CBFGcSBH.js";import"./check-CpE1Y6oa.js";import"./chevron-left-DV7PNrfQ.js";import"./chevron-right-Beks09DK.js";const A={search:"",type:[],location:[],bedrooms:[],amenities:[],priceMin:"",priceMax:"",sizeMin:"",sizeMax:"",sort:"price_asc"};function J(){const{t:m}=L(),{filters:i,setFilters:x,currentPage:r,setPage:P,clearFilters:j}=T("new-building",A),[n,u]=a.useState(!0),[y,S]=a.useState([]),[g,f]=a.useState(0),[I,N]=a.useState(0),l=_();return a.useEffect(()=>{const t=()=>{n||sessionStorage.setItem(`scroll_${l.pathname}`,window.scrollY.toString())};return window.addEventListener("scroll",t),()=>window.removeEventListener("scroll",t)},[l.pathname,n]),a.useEffect(()=>{let t=!1;return(async()=>{u(!0),f(void 0);try{const{location:s=[],bedrooms:c=[],type:h=[],amenities:v=[],...b}=i,d={...b,type:"Off-Plan",page:r,limit:24,subtype:h.length?h.join(","):void 0,amenities:v.length?v:void 0,ids:i.ids&&i.ids.length?i.ids.join(","):void 0,town:s.length?s:void 0,beds:c.length?c.map(o=>o==="studio"?0:o):void 0,beds_exact:c.length?"true":void 0};s.includes("Málaga")&&!d.search&&(d.search="Málaga");const p=await C(d);if(!t){let o=p.data||[];s.length>0&&(o=o.filter(F=>s.includes(F.town))),S(o),f(p.totalItems||0),N(p.totalPages||0);const w=sessionStorage.getItem(`scroll_${l.pathname}`);w&&setTimeout(()=>{window.scrollTo({top:parseInt(w,10),behavior:"instant"})},50)}}catch(s){t||console.error("Failed to load project properties:",s)}finally{t||u(!1)}})(),()=>{t=!0}},[i,r]),e.jsxs("div",{className:"new-building-page",children:[e.jsx("div",{className:"filters-section",children:e.jsx("div",{className:"container",children:e.jsx(E,{pageType:"new-building",filters:i,onFilterChange:x,onClearFilters:j,totalCount:g})})}),e.jsx("main",{className:"main-content",children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"listing-header",children:[e.jsx("h2",{className:"listing-title",children:m("pages.newBuilding.title")}),e.jsx("span",{className:"listing-count",children:m("filters.resultsFound").replace("{count}",g||0)})]}),e.jsx(M,{properties:y,loading:n,currentPage:r,totalPages:I,onPageChange:P})]})})]})}export{J as default};
