import{u as _,j as t}from"./index-BN0U1Jbm.js";import{r as n}from"./mapbox-gl-Baw0grWs.js";import{u as A,P as D}from"./PropertyFilters-BeNMtFYY.js";import{P as k}from"./PropertyGrid-DEE2gnWW.js";import{g as $}from"./client-DjafAzYx.js";/* empty css                          */import{s as B}from"./staticLocations-DV_s1RsA.js";import{u as G}from"./vendor-B3DjV561.js";import"./check-EumFHPxi.js";import"./chevron-left-d_pySqh2.js";import"./chevron-right-Co77G4Ek.js";const O={search:"",type:[],location:[],bedrooms:[],amenities:[],priceMin:"",priceMax:"",sizeMin:"",sizeMax:"",sort:"price_asc"};function ee(){const{t:y}=_(),{filters:i,setFilters:F,currentPage:d,setPage:I,clearFilters:b}=A("secondary",O),[m,x]=n.useState(!0),[T,C]=n.useState([]),[j,w]=n.useState(0),[E,z]=n.useState(0),p=G();return n.useEffect(()=>{const o=()=>{m||sessionStorage.setItem(`scroll_${p.pathname}`,window.scrollY.toString())};return window.addEventListener("scroll",o),()=>window.removeEventListener("scroll",o)},[p.pathname,m]),n.useEffect(()=>{let o=!1;return(async()=>{x(!0),w(void 0);try{const{location:u=[],bedrooms:f=[],type:P=[],amenities:S=[],...L}=i;let a=[...u],l=L.search||"";const r=e=>e?e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim():"";if(l.trim()){const e=r(l);let s=null;for(const[c,v]of Object.entries(B)){if(r(c)===e){s=c;break}const N=v.find(M=>r(M)===e);if(N){s=N;break}}s&&(a.includes(s)||a.push(s),l="")}const g={...L,search:l||void 0,type:"Secondary",page:d,limit:24,subtype:P.length?P.join(","):void 0,amenities:S.length?S:void 0,ids:i.ids&&i.ids.length?i.ids.join(","):void 0,town:a.length?a:void 0,beds:f.length?f.map(e=>e==="studio"?0:e):void 0,beds_exact:f.length?"true":void 0};a.some(e=>r(e)==="malaga")&&!g.search&&(g.search="MÃ¡laga");const h=await $(g);if(!o){let e=h.data||[];a.length>0&&(e=e.filter(c=>a.some(v=>r(v)===r(c.town)))),C(e),w(h.totalItems||0),z(h.totalPages||0);const s=sessionStorage.getItem(`scroll_${p.pathname}`);s&&setTimeout(()=>{window.scrollTo({top:parseInt(s,10),behavior:"instant"})},50)}}catch(u){o||console.error("Failed to load secondary properties:",u)}finally{o||x(!1)}})(),()=>{o=!0}},[i,d]),t.jsxs("div",{className:"secondary-page",children:[t.jsx("div",{className:"filters-section",children:t.jsx("div",{className:"container",children:t.jsx(D,{pageType:"secondary",filters:i,onFilterChange:F,onClearFilters:b,totalCount:j})})}),t.jsx("main",{className:"main-content",children:t.jsxs("div",{className:"container",children:[t.jsxs("div",{className:"listing-header",children:[t.jsx("h2",{className:"listing-title",children:y("pages.secondary.title")}),t.jsx("span",{className:"listing-count",children:y("filters.resultsFound").replace("{count}",j||0)})]}),t.jsx(k,{properties:T,loading:m,currentPage:d,totalPages:E,onPageChange:I})]})})]})}export{ee as default};
