import{u as M,j as t}from"./index-Bt-nM8nf.js";import{r as n}from"./mapbox-gl-BQyo5stt.js";import{u as A,P as D}from"./PropertyFilters-Bz3p8KVI.js";import{P as R}from"./PropertyGrid-BnOxDPFl.js";import{g as k}from"./client-DjafAzYx.js";/* empty css                          */import{s as $}from"./staticLocations-CmEF74P4.js";import{u as B}from"./vendor-CWHnZUEh.js";import"./check-BpS2--3V.js";import"./chevron-left-B8F2JZZz.js";import"./chevron-right-DqiLAAY1.js";const G={search:"",type:[],location:[],bedrooms:[],amenities:[],priceMin:"",priceMax:"",sizeMin:"",sizeMax:"",sort:"price_asc",rentType:"long"};function ee(){const{t:x}=M(),{filters:i,setFilters:T,currentPage:m,setPage:F,clearFilters:I}=A("rent",G),[d,j]=n.useState(!0),[b,C]=n.useState([]),[w,y]=n.useState(0),[E,_]=n.useState(0),p=B();return n.useEffect(()=>{const o=()=>{d||sessionStorage.setItem(`scroll_${p.pathname}`,window.scrollY.toString())};return window.addEventListener("scroll",o),()=>window.removeEventListener("scroll",o)},[p.pathname,d]),n.useEffect(()=>{let o=!1;return(async()=>{j(!0),y(void 0);try{const{location:u=[],bedrooms:f=[],type:P=[],amenities:S=[],...L}=i;let a=[...u],l=L.search||"";const r=e=>e?e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim():"";if(l.trim()){const e=r(l);let s=null;for(const[c,v]of Object.entries($)){if(r(c)===e){s=c;break}const N=v.find(z=>r(z)===e);if(N){s=N;break}}s&&(a.includes(s)||a.push(s),l="")}const g={...L,search:l||void 0,type:"Rent",page:m,limit:24,subtype:P.length?P.join(","):void 0,amenities:S.length?S:void 0,ids:i.ids&&i.ids.length?i.ids.join(","):void 0,town:a.length?a:void 0,beds:f.length?f.map(e=>e==="studio"?0:e):void 0,beds_exact:f.length?"true":void 0,rent_type:i.rentType};a.some(e=>r(e)==="malaga")&&!g.search&&(g.search="MÃ¡laga");const h=await k(g);if(!o){let e=h.data||[];a.length>0&&(e=e.filter(c=>a.some(v=>r(v)===r(c.town)))),C(e),y(h.totalItems||0),_(h.totalPages||0);const s=sessionStorage.getItem(`scroll_${p.pathname}`);s&&setTimeout(()=>{window.scrollTo({top:parseInt(s,10),behavior:"instant"})},50)}}catch(u){o||console.error("Failed to load rent properties:",u)}finally{o||j(!1)}})(),()=>{o=!0}},[i,m]),t.jsxs("div",{className:"rent-page",children:[t.jsx("div",{className:"filters-section",children:t.jsx("div",{className:"container",children:t.jsx(D,{pageType:"rent",filters:i,onFilterChange:T,onClearFilters:I,totalCount:w})})}),t.jsx("main",{className:"main-content",children:t.jsxs("div",{className:"container",children:[t.jsxs("div",{className:"listing-header",children:[t.jsx("h2",{className:"listing-title",children:x("pages.rent.title")}),t.jsx("span",{className:"listing-count",children:x("filters.resultsFound").replace("{count}",w||0)})]}),t.jsx(R,{properties:b,loading:d,currentPage:m,totalPages:E,onPageChange:F})]})})]})}export{ee as default};
